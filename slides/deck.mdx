import { Image } from 'mdx-deck'
import Footer from 'mdx-deck-footer'
import { lensPath, set } from 'ramda'
import { CodeSurfer } from 'code-surfer'
import { nightOwl } from '@code-surfer/themes'
import 'prismjs/components/prism-haskell'
import mu from './mu-graphql.jpg'

export const theme = set(
  lensPath(['styles', 'CodeSurfer', 'code', 'fontFamily']),
  '"Dank Mono", "Fira Code", Consolas, "Roboto Mono", monospace'
)(nightOwl)
const conf = 'Berlin Functional Programming Group 🇩🇪'
const speaker = '@FlavioCorpa'

<Image src={mu} />

---

<Footer conf={conf} speaker={speaker}>

# mu-haskell + GraphQL = 💜

</Footer>

---

<CodeSurfer>

```graphql file=../schema.graphql title="This is our source of truth 🧼"

```

</CodeSurfer>

---

<CodeSurfer>

```haskell file=../src/Main.hs title="Our first GraphQL Server! 🚀"

```

```haskell subtitle="Let's start simple"
module Main where
```

```haskell subtitle="Well need a few imports... 📦"
module Main where

import Data.List (find)
import Data.Proxy
import Data.Text (Text)
import Mu.GraphQL.Quasi
import Mu.GraphQL.Server
import Mu.Schema
import Mu.Server
```

```haskell 6:10 subtitle="These are the important ones 👆🏼"
module Main where

import Data.List (find)
import Data.Proxy
import Data.Text (Text)
import Mu.GraphQL.Quasi
import Mu.GraphQL.Server
import Mu.Schema
import Mu.Server
```

```haskell subtitle="...and, of course, a bunch of language extensions! 🤣"
{-# LANGUAGE DataKinds #-}
{-# LANGUAGE FlexibleContexts #-}
{-# LANGUAGE OverloadedStrings #-}
{-# LANGUAGE PartialTypeSignatures #-}
{-# LANGUAGE PolyKinds #-}
{-# LANGUAGE ScopedTypeVariables #-}
{-# LANGUAGE TemplateHaskell #-}
{-# LANGUAGE TupleSections #-}
{-# LANGUAGE TypeApplications #-}
{-# LANGUAGE TypeOperators #-}

module Main where

import Data.List (find)
import Data.Proxy
import Data.Text (Text)
import Mu.GraphQL.Quasi
import Mu.GraphQL.Server
import Mu.Schema
import Mu.Server
```

```haskell subtitle="Optionally (in case you are a warning freak) 🙈"
{-# LANGUAGE DataKinds #-}
{-# LANGUAGE FlexibleContexts #-}
{-# LANGUAGE OverloadedStrings #-}
{-# LANGUAGE PartialTypeSignatures #-}
{-# LANGUAGE PolyKinds #-}
{-# LANGUAGE ScopedTypeVariables #-}
{-# LANGUAGE TemplateHaskell #-}
{-# LANGUAGE TupleSections #-}
{-# LANGUAGE TypeApplications #-}
{-# LANGUAGE TypeOperators #-}
{-# OPTIONS_GHC -fno-warn-partial-type-signatures #-}

module Main where

import Data.List (find)
import Data.Proxy
import Data.Text (Text)
import Mu.GraphQL.Quasi
import Mu.GraphQL.Server
import Mu.Schema
import Mu.Server
```

```haskell subtitle="This is were the magic happens! ✨"
{-# LANGUAGE DataKinds #-}
{-# LANGUAGE FlexibleContexts #-}
{-# LANGUAGE OverloadedStrings #-}
{-# LANGUAGE PartialTypeSignatures #-}
{-# LANGUAGE PolyKinds #-}
{-# LANGUAGE ScopedTypeVariables #-}
{-# LANGUAGE TemplateHaskell #-}
{-# LANGUAGE TupleSections #-}
{-# LANGUAGE TypeApplications #-}
{-# LANGUAGE TypeOperators #-}
{-# OPTIONS_GHC -fno-warn-partial-type-signatures #-}

module Main where

import Data.List (find)
import Data.Proxy
import Data.Text (Text)
import Mu.GraphQL.Quasi
import Mu.GraphQL.Server
import Mu.Schema
import Mu.Server

graphql "ServiceDefinition" "schema.graphql"
```

```haskell subtitle="Our main function ✴️"
{-# LANGUAGE DataKinds #-}
{-# LANGUAGE FlexibleContexts #-}
{-# LANGUAGE OverloadedStrings #-}
{-# LANGUAGE PartialTypeSignatures #-}
{-# LANGUAGE PolyKinds #-}
{-# LANGUAGE ScopedTypeVariables #-}
{-# LANGUAGE TemplateHaskell #-}
{-# LANGUAGE TupleSections #-}
{-# LANGUAGE TypeApplications #-}
{-# LANGUAGE TypeOperators #-}
{-# OPTIONS_GHC -fno-warn-partial-type-signatures #-}

module Main where

import Data.List (find)
import Data.Proxy
import Data.Text (Text)
import Mu.GraphQL.Quasi
import Mu.GraphQL.Server
import Mu.Schema
import Mu.Server

graphql "ServiceDefinition" "schema.graphql"

-- GraphQL App

main :: IO ()
main = do
  putStrLn "starting GraphQL server on port 8080"
  runGraphQLAppQuery 8080 server (Proxy @"Query")
```

```haskell subtitle="Service mapping 🗺"
{-# LANGUAGE DataKinds #-}
{-# LANGUAGE FlexibleContexts #-}
{-# LANGUAGE OverloadedStrings #-}
{-# LANGUAGE PartialTypeSignatures #-}
{-# LANGUAGE PolyKinds #-}
{-# LANGUAGE ScopedTypeVariables #-}
{-# LANGUAGE TemplateHaskell #-}
{-# LANGUAGE TupleSections #-}
{-# LANGUAGE TypeApplications #-}
{-# LANGUAGE TypeOperators #-}
{-# OPTIONS_GHC -fno-warn-partial-type-signatures #-}

module Main where

import Data.List (find)
import Data.Proxy
import Data.Text (Text)
import Mu.GraphQL.Quasi
import Mu.GraphQL.Server
import Mu.Schema
import Mu.Server

graphql "ServiceDefinition" "schema.graphql"

-- GraphQL App

main :: IO ()
main = do
  putStrLn "starting GraphQL server on port 8080"
  runGraphQLAppQuery 8080 server (Proxy @"Query")

type ServiceMapping =
  '[ "Book" ':-> (Text, Text),
     "Author" ':-> Text
   ]

```

```haskell subtitle="Example hardcoded library 📚"
{-# LANGUAGE DataKinds #-}
{-# LANGUAGE FlexibleContexts #-}
{-# LANGUAGE OverloadedStrings #-}
{-# LANGUAGE PartialTypeSignatures #-}
{-# LANGUAGE PolyKinds #-}
{-# LANGUAGE ScopedTypeVariables #-}
{-# LANGUAGE TemplateHaskell #-}
{-# LANGUAGE TupleSections #-}
{-# LANGUAGE TypeApplications #-}
{-# LANGUAGE TypeOperators #-}
{-# OPTIONS_GHC -fno-warn-partial-type-signatures #-}

module Main where

import Data.List (find)
import Data.Proxy
import Data.Text (Text)
import Mu.GraphQL.Quasi
import Mu.GraphQL.Server
import Mu.Schema
import Mu.Server

graphql "ServiceDefinition" "schema.graphql"

-- GraphQL App

main :: IO ()
main = do
  putStrLn "starting GraphQL server on port 8080"
  runGraphQLAppQuery 8080 server (Proxy @"Query")

type ServiceMapping =
  '[ "Book" ':-> (Text, Text),
     "Author" ':-> Text
   ]

library :: [(Text, [Text])]
library =
  [ ("Robert Louis Stevenson", ["Treasure Island", "Strange Case of Dr Jekyll and Mr Hyde"]),
    ("Immanuel Kant", ["Critique of Pure Reason"]),
    ("Michael Ende", ["The Neverending Story", "Momo"])
  ]
```

```haskell subtitle="Server implementation 🤖"
{-# LANGUAGE DataKinds #-}
{-# LANGUAGE FlexibleContexts #-}
{-# LANGUAGE OverloadedStrings #-}
{-# LANGUAGE PartialTypeSignatures #-}
{-# LANGUAGE PolyKinds #-}
{-# LANGUAGE ScopedTypeVariables #-}
{-# LANGUAGE TemplateHaskell #-}
{-# LANGUAGE TupleSections #-}
{-# LANGUAGE TypeApplications #-}
{-# LANGUAGE TypeOperators #-}
{-# OPTIONS_GHC -fno-warn-partial-type-signatures #-}

module Main where

import Data.List (find)
import Data.Proxy
import Data.Text (Text)
import Mu.GraphQL.Quasi
import Mu.GraphQL.Server
import Mu.Schema
import Mu.Server

graphql "ServiceDefinition" "schema.graphql"

-- GraphQL App

main :: IO ()
main = do
  putStrLn "starting GraphQL server on port 8080"
  runGraphQLAppQuery 8080 server (Proxy @"Query")

type ServiceMapping =
  '[ "Book" ':-> (Text, Text),
     "Author" ':-> Text
   ]

library :: [(Text, [Text])]
library =
  [ ("Robert Louis Stevenson", ["Treasure Island", "Strange Case of Dr Jekyll and Mr Hyde"]),
    ("Immanuel Kant", ["Critique of Pure Reason"]),
    ("Michael Ende", ["The Neverending Story", "Momo"])
  ]

server :: forall m. MonadServer m => ServerT ServiceMapping ServiceDefinition m _
server =
  resolver
    ( object @"Book"
        ( field @"title" bookTitle,
          field @"author" bookAuthor
        ),
      object @"Author"
        ( field @"name" authorName,
          field @"books" authorBooks
        ),
      object @"Query"
        ( method @"authors" allAuthors,
          method @"books" allBooks
        )
    )
```

```haskell 44[20:36] subtitle="Our 'special' Monad, not that special really 🌟"
{-# LANGUAGE DataKinds #-}
{-# LANGUAGE FlexibleContexts #-}
{-# LANGUAGE OverloadedStrings #-}
{-# LANGUAGE PartialTypeSignatures #-}
{-# LANGUAGE PolyKinds #-}
{-# LANGUAGE ScopedTypeVariables #-}
{-# LANGUAGE TemplateHaskell #-}
{-# LANGUAGE TupleSections #-}
{-# LANGUAGE TypeApplications #-}
{-# LANGUAGE TypeOperators #-}
{-# OPTIONS_GHC -fno-warn-partial-type-signatures #-}

module Main where

import Data.List (find)
import Data.Proxy
import Data.Text (Text)
import Mu.GraphQL.Quasi
import Mu.GraphQL.Server
import Mu.Schema
import Mu.Server

graphql "ServiceDefinition" "schema.graphql"

-- GraphQL App

main :: IO ()
main = do
  putStrLn "starting GraphQL server on port 8080"
  runGraphQLAppQuery 8080 server (Proxy @"Query")

type ServiceMapping =
  '[ "Book" ':-> (Text, Text),
     "Author" ':-> Text
   ]

library :: [(Text, [Text])]
library =
  [ ("Robert Louis Stevenson", ["Treasure Island", "Strange Case of Dr Jekyll and Mr Hyde"]),
    ("Immanuel Kant", ["Critique of Pure Reason"]),
    ("Michael Ende", ["The Neverending Story", "Momo"])
  ]

server :: forall m. MonadServer m => ServerT ServiceMapping ServiceDefinition m _
server =
  resolver
    ( object @"Book"
        ( field @"title" bookTitle,
          field @"author" bookAuthor
        ),
      object @"Author"
        ( field @"name" authorName,
          field @"books" authorBooks
        ),
      object @"Query"
        ( method @"authors" allAuthors,
          method @"books" allBooks
        )
    )
```

```haskell 44[80:81] title="Remember PartialTypeSignatures?" subtitle="This can be completely inferred! 🤓"
{-# LANGUAGE DataKinds #-}
{-# LANGUAGE FlexibleContexts #-}
{-# LANGUAGE OverloadedStrings #-}
{-# LANGUAGE PartialTypeSignatures #-}
{-# LANGUAGE PolyKinds #-}
{-# LANGUAGE ScopedTypeVariables #-}
{-# LANGUAGE TemplateHaskell #-}
{-# LANGUAGE TupleSections #-}
{-# LANGUAGE TypeApplications #-}
{-# LANGUAGE TypeOperators #-}
{-# OPTIONS_GHC -fno-warn-partial-type-signatures #-}

module Main where

import Data.List (find)
import Data.Proxy
import Data.Text (Text)
import Mu.GraphQL.Quasi
import Mu.GraphQL.Server
import Mu.Schema
import Mu.Server

graphql "ServiceDefinition" "schema.graphql"

-- GraphQL App

main :: IO ()
main = do
  putStrLn "starting GraphQL server on port 8080"
  runGraphQLAppQuery 8080 server (Proxy @"Query")

type ServiceMapping =
  '[ "Book" ':-> (Text, Text),
     "Author" ':-> Text
   ]

library :: [(Text, [Text])]
library =
  [ ("Robert Louis Stevenson", ["Treasure Island", "Strange Case of Dr Jekyll and Mr Hyde"]),
    ("Immanuel Kant", ["Critique of Pure Reason"]),
    ("Michael Ende", ["The Neverending Story", "Momo"])
  ]

server :: forall m. MonadServer m => ServerT ServiceMapping ServiceDefinition m _
server =
  resolver
    ( object @"Book"
        ( field @"title" bookTitle,
          field @"author" bookAuthor
        ),
      object @"Author"
        ( field @"name" authorName,
          field @"books" authorBooks
        ),
      object @"Query"
        ( method @"authors" allAuthors,
          method @"books" allBooks
        )
    )
```

```haskell 48[26:34],49[26:36],52[25:34],53[26:36],56[29:38],57[26:34] subtitle="But... what are all these!? 🤔"
{-# LANGUAGE DataKinds #-}
{-# LANGUAGE FlexibleContexts #-}
{-# LANGUAGE OverloadedStrings #-}
{-# LANGUAGE PartialTypeSignatures #-}
{-# LANGUAGE PolyKinds #-}
{-# LANGUAGE ScopedTypeVariables #-}
{-# LANGUAGE TemplateHaskell #-}
{-# LANGUAGE TupleSections #-}
{-# LANGUAGE TypeApplications #-}
{-# LANGUAGE TypeOperators #-}
{-# OPTIONS_GHC -fno-warn-partial-type-signatures #-}

module Main where

import Data.List (find)
import Data.Proxy
import Data.Text (Text)
import Mu.GraphQL.Quasi
import Mu.GraphQL.Server
import Mu.Schema
import Mu.Server

graphql "ServiceDefinition" "schema.graphql"

-- GraphQL App

main :: IO ()
main = do
  putStrLn "starting GraphQL server on port 8080"
  runGraphQLAppQuery 8080 server (Proxy @"Query")

type ServiceMapping =
  '[ "Book" ':-> (Text, Text),
     "Author" ':-> Text
   ]

library :: [(Text, [Text])]
library =
  [ ("Robert Louis Stevenson", ["Treasure Island", "Strange Case of Dr Jekyll and Mr Hyde"]),
    ("Immanuel Kant", ["Critique of Pure Reason"]),
    ("Michael Ende", ["The Neverending Story", "Momo"])
  ]

server :: forall m. MonadServer m => ServerT ServiceMapping ServiceDefinition m _
server =
  resolver
    ( object @"Book"
        ( field @"title" bookTitle,
          field @"author" bookAuthor
        ),
      object @"Author"
        ( field @"name" authorName,
          field @"books" authorBooks
        ),
      object @"Query"
        ( method @"authors" allAuthors,
          method @"books" allBooks
        )
    )
```

```haskell file=../src/Main.hs subtitle="...just some helpers we defined! 🛠"

```

```haskell 61:64 file=../src/Main.hs subtitle="We implement the resolvers for our book type 📖"

```

```haskell 65:68 file=../src/Main.hs subtitle="Resolvers for our author type (of course this could come from a database)"

```

```haskell 69:72 file=../src/Main.hs subtitle="Resolvers for our possible queries... let your imagination fly! 💸"

```

```haskell file=../src/Main.hs title="That. Is. All! 🎉"

```

</CodeSurfer>

---

<Footer conf={conf} speaker={speaker}>

> Demo time!? ⏱

</Footer>

---

<Footer conf={conf} speaker={speaker}>

### Check it out!

> https://github.com/higherkindness/mu-haskell

</Footer>

---

<Footer conf={conf} speaker={speaker}>

# Thanks! λ 😸

</Footer>
